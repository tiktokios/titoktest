// {
// "status": "success",
// "result": {
// "type": "video",
// "author": {
// "avatar": "https://p16-sign-va.tiktokcdn.com/tos-maliva-avt-0068/a722dee32f65207d0516eb1bb3f3ae25~c5_300x300.jpeg?lk3s=45126217&nonce=60751&refresh_token=045dc00c8c2cba2161b9a09c0106d083&x-expires=1713546000&x-signature=EGRuOabw0Zyw88WVr2aBLSf6wnA%3D",
// "nickname": "sadarjiwa01"
// },
// "desc": "Terima kasih atas kerja kerasmu pak #jokowi #jokowidodo #fypシ゚viral #sadstory #sadvibes #foryoupage",
// "music": "https://sf16-ies-music-va.tiktokcdn.com/obj/musically-maliva-obj/7267457587866897157.mp3",
// "video1": "https://fastdl.muscdn.app/dl?url=aHR0cHM6Ly92MTZtLWRlZmF1bHQuYWthbWFpemVkLm5ldC8wZWI0N2FhMGI4NWIxNjcxYTAzMWYwNjE2ZWNmNTRjYS82NjIxYWFhZC92aWRlby90b3MvdXNlYXN0MmEvdG9zLXVzZWFzdDJhLXZlLTAwNjhjMDAzL29vQTlDN1VlV1hJSGZrRmtFS0dYNGVMb2FlTnJBQVNnQzhSY1JKLz9hPTAmYnRpPU9VQnpPVGc3UUdvNk9qWkFMM0FqTFRBellDTXhORE5nJmNoPTAmY3I9MCZkcj0wJmxyPWFsbCZjZD0wJTdDMCU3QzAlN0MwJmJyPTIwMzYmYnQ9MTAxOCZjcz0wJmRzPTYmZnQ9WEU1YkNxVDBtN2pQRDEyODl5cjczd1VXckl5S01lRn5PNSZtaW1lX3R5cGU9dmlkZW9fbXA0JnFzPTAmcmM9WldZOE0yWTFaenMyWnp0b05EczdQRUJwYW1sa08yNDVjbkYwY1RNek56Z3pNMEF3TmpaaE1UVTJYelF4TlRVdE1ERXVZU05lY0RGa01tUmpOR2xnTFMxa0x6WnpjdyUzRCUzRCZ2dnBsPTEmbD0yMDI0MDQxODE3MTkxNTI2NzQ4MEU1ODk5Q0NDM0RFODQzJmJ0YWc9ZTAwMDg4MDAw&name=c2FkYXJqaXdhMDE=&id=NzM3NTIwMjU2Ng==&type=mp4",
// "video2": "https://v16m-default.akamaized.net/0eb47aa0b85b1671a031f0616ecf54ca/6621aaad/video/tos/useast2a/tos-useast2a-ve-0068c003/ooA9C7UeWXIHfkFkEKGX4eLoaeNrAASgC8RcRJ/?a=0&bti=OUBzOTg7QGo6OjZAL3AjLTAzYCMxNDNg&ch=0&cr=0&dr=0&lr=all&cd=0%7C0%7C0%7C0&br=2036&bt=1018&cs=0&ds=6&ft=XE5bCqT0m7jPD1289yr73wUWrIyKMeF~O5&mime_type=video_mp4&qs=0&rc=ZWY8M2Y1Zzs2ZztoNDs7PEBpamlkO245cnF0cTMzNzgzM0AwNjZhMTU2XzQxNTUtMDEuYSNecDFkMmRjNGlgLS1kLzZzcw%3D%3D&vvpl=1&l=20240418171915267480E5899CCC3DE843&btag=e00088000",
// "videoHD": "https://dl.muscdn.app/c2FkYXJqaXdhMDE=/hd/aHR0cHM6Ly92MTZtLWRlZmF1bHQuYWthbWFpemVkLm5ldC9iODI3MTI0NmIzZjI2NTIxNDdmMDk1YWZiMmRiNTliZC82NjIxYWFhZC92aWRlby90b3MvdXNlYXN0MmEvdG9zLXVzZWFzdDJhLXYtMDA2OC9vSUFpb2QyZ0JFRDlWcjBIQXVpQWtnS3VQQWZpeUFnRWlHb2dCOS8/YT0wJmJ0aT1iR1J1Wkh4dk1YSXhjbTUzWm0xY1lGOWViV0Z6YUhGbU9nJTNEJTNEJmNoPTAmY3I9MCZkcj0wJmVyPTAmY2Q9MCU3QzAlN0MwJTdDMCZicj0yNDY4MCZidD0xMjM0MCZkcz00JmZ0PWFFS3BDcVQwbTdqUEQxMjg5eXI3M3dVV3JJeUtNZUZ+TzUmbWltZV90eXBlPXZpZGVvX21wNCZxcz0xMyZyYz1hbWxrTzI0NWNuRjBjVE16Tnpnek0wQnBhbWxrTzI0NWNuRjBjVE16Tnpnek0wQmVjREZrTW1Sak5HbGdMUzFrTHpaellTTmVjREZrTW1Sak5HbGdMUzFrTHpaemN3JTNEJTNEJnZ2cGw9MSZsPTIwMjQwNDE4MTcxOTE1OEM4REMzNDAxNDIzMDEzQ0VDREYmYnRhZz1lMDAwNDgwMDAmY2M9Mw==",
// "videoWatermark": "https://fastdl.muscdn.app/dl?url=aHR0cHM6Ly92MTZtLWRlZmF1bHQuYWthbWFpemVkLm5ldC9iZWRiNmU2MzUxNTYxYjgzMTMyYzVjNDZhZTcxMGE5ZS82NjIxYWFhZC92aWRlby90b3MvdXNlYXN0MmEvdG9zLXVzZWFzdDJhLXZlLTAwNjhjMDAyL29jNElBWHJRQ0tMUkZIWHFDTG83SkJJU1hHU2Zla0FlV2dFZXZrLz9hPTAmYnRpPU9VQnpPVGc3UUdvNk9qWkFMM0FqTFRBellDTXhORE5nJmNoPTAmY3I9MCZkcj0wJmxyPWFsbCZjZD0wJTdDMCU3QzAlN0MwJmJyPTI2MDQmYnQ9MTMwMiZjcz0wJmRzPTMmZnQ9WEU1YkNxVDBtN2pQRDEyODl5cjczd1VXckl5S01lRn5PNSZtaW1lX3R5cGU9dmlkZW9fbXA0JnFzPTAmcmM9YURvNU5UUmtOMlE2TkR4b04yazZQRUJwYW1sa08yNDVjbkYwY1RNek56Z3pNMEF5TmpVdU1HSXlYeTR4TkRFeFhtTmpZU05lY0RGa01tUmpOR2xnTFMxa0x6WnpjdyUzRCUzRCZ2dnBsPTEmbD0yMDI0MDQxODE3MTkxNTI2NzQ4MEU1ODk5Q0NDM0RFODQzJmJ0YWc9ZTAwMDg4MDAw&name=c2FkYXJqaXdhMDE=&id=NzM3NTIwMjU2Ng==&type=mp4"
// }
// }

// Path: src/pages/api/tik.json.ts
import { toast, Toaster } from 'solid-toast';


import { createSignal } from "solid-js";
type Props = {}
interface TikTokData {
    status: string | null;
    result: {
        type: string | null;
        author: {
            avatar: string | null;
            nickname: string | null;
        };
        desc?: string | null;
        music?: string | null;
        video1?: string | null;
        video2?: string | null;
        videoHD?: string | null;
        videoWatermark?: string | null;
    }
}

function InputScreen({ }: Props) {

    const [url, setUrl] = createSignal("");
    const [data, setData] = createSignal<TikTokData | null>(null);
    const [loading, setLoading] = createSignal(false);
    const [error, setError] = createSignal("");
    let fetchData = async () => {
        setLoading(true)
        try {
            let res = await fetch(`/api/tik.json?url=${url()}`)
            let json = await res.json()
            if (json.status == "error") {
                throw new Error(json.message)

            } else {
                setData(json ?? null)
                setError("")

            }

            setLoading(false)
        } catch (error) {
            toast.error(error.message, {
                duration: 3000,
                position: 'bottom-center',
                style: {
                    'font-size': '16px',
                },
            });
            setData(null)
            // setError(error.message)

        }
        setLoading(false)
    }
    return (
        <div>
            <Toaster />



            
<form class="flex flex-1 items-center justify-center p-6">   
    <label for="voice-search" class="sr-only">Search</label>
    <div class="relative w-full">
        <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
       
        
        </div>
        <input
                    x-ref="input"
                    placeholder="Insert Tiktok URL"
                    class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full ps-10 p-3 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                    required={true}
                    type="text"
                    onChange={(e) => setUrl(e.currentTarget.value)}
                    value={url()}
                />

 <button aria-label="Paste"
                    onclick={async (e) => {
                        e.preventDefault();

                        //ask for permission to access clipboard readText
                        await navigator.permissions.query({ name: 'clipboard-read' as any }).then((result) => {
                            if (result.state == 'granted' || result.state == 'prompt') {
                                navigator.clipboard.readText().then((text) => {
                                    setUrl(text);
                                });
                            }
                        });

                        navigator.clipboard.readText().then((text) => {
                            setUrl(text);
                        });
                    }}
                    class="absolute inset-y-0 end-0 flex items-center pe-3 dark:text-white">
                   <svg class="h-6 w-6 text-red-500"  width="14" height="14" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">  <path stroke="none" d="M0 0h24v24H0z"/>  <rect x="8" y="8" width="12" height="12" rx="2" />  <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2" /></svg>

                </button>
        
       
    </div>


    <button
                    onclick={(e) => {
                        e.preventDefault();
                        if (url() == '') {
                            toast.error('Please enter a valid url or username', {
                                duration: 3000,
                                position: 'bottom-center',
                                style: {
                                    'font-size': '16px',
                                },
                            });
                        } else {
                            fetchData();
                        }
                    }}
                    class="inline-flex items-center py-2.5 px-3 ms-2 text-sm font-medium text-white bg-blue-700 rounded-lg border border-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">
       
        <svg class="w-6 h-6 me-2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="#ffffff"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M12 7L12 14M12 14L15 11M12 14L9 11" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M16 17H12H8" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round"></path> <path d="M2 12C2 7.28595 2 4.92893 3.46447 3.46447C4.92893 2 7.28595 2 12 2C16.714 2 19.0711 2 20.5355 3.46447C22 4.92893 22 7.28595 22 12C22 16.714 22 19.0711 20.5355 20.5355C19.0711 22 16.714 22 12 22C7.28595 22 4.92893 22 3.46447 20.5355C2 19.0711 2 16.714 2 12Z" stroke="#ffffff" stroke-width="1.5"></path> </g></svg>
        <span class="px-1 flex items-center font-medium tracking-wide"> Download </span>
                </button>
</form>


            
            
            
            {loading() && <div class='flex justify-center'><svg
            class=" -ml-1 mr-3 h-10 w-10  text-center"
            xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" width="200" height="200" style="shape-rendering: auto; display: block; background: transparent;"><g><circle cx="84" cy="50" r="10" fill="#527eff">
                <animate attributeName="r" repeatCount="indefinite" dur="0.25s" calcMode="spline" keyTimes="0;1" values="10;0" keySplines="0 0.5 0.5 1" begin="0s" />
                <animate attributeName="fill" repeatCount="indefinite" dur="1s" calcMode="discrete" keyTimes="0;0.25;0.5;0.75;1" values="#527eff;#2a12ff;#6ad6f8;#50d6d2;#527eff" begin="0s" />
            </circle><circle cx="16" cy="50" r="10" fill="#527eff">
                    <animate attributeName="r" repeatCount="indefinite" dur="1s" calcMode="spline" keyTimes="0;0.25;0.5;0.75;1" values="0;0;10;10;10" keySplines="0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1" begin="0s" />
                    <animate attributeName="cx" repeatCount="indefinite" dur="1s" calcMode="spline" keyTimes="0;0.25;0.5;0.75;1" values="16;16;16;50;84" keySplines="0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1" begin="0s" />
                </circle><circle cx="50" cy="50" r="10" fill="#50d6d2">
                    <animate attributeName="r" repeatCount="indefinite" dur="1s" calcMode="spline" keyTimes="0;0.25;0.5;0.75;1" values="0;0;10;10;10" keySplines="0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1" begin="-0.25s" />
                    <animate attributeName="cx" repeatCount="indefinite" dur="1s" calcMode="spline" keyTimes="0;0.25;0.5;0.75;1" values="16;16;16;50;84" keySplines="0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1" begin="-0.25s" />
                </circle><circle cx="84" cy="50" r="10" fill="#6ad6f8">
                    <animate attributeName="r" repeatCount="indefinite" dur="1s" calcMode="spline" keyTimes="0;0.25;0.5;0.75;1" values="0;0;10;10;10" keySplines="0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1" begin="-0.5s" />
                    <animate attributeName="cx" repeatCount="indefinite" dur="1s" calcMode="spline" keyTimes="0;0.25;0.5;0.75;1" values="16;16;16;50;84" keySplines="0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1" begin="-0.5s" />
                </circle><circle cx="16" cy="50" r="10" fill="#2a12ff">
                    <animate attributeName="r" repeatCount="indefinite" dur="1s" calcMode="spline" keyTimes="0;0.25;0.5;0.75;1" values="0;0;10;10;10" keySplines="0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1" begin="-0.75s" />
                    <animate attributeName="cx" repeatCount="indefinite" dur="1s" calcMode="spline" keyTimes="0;0.25;0.5;0.75;1" values="16;16;16;50;84" keySplines="0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1" begin="-0.75s" />
                </circle><g /></g></svg></div>}
            {error() && <div>Error: {error()}</div>}
            {data() && (
                <div class='mt-2'>
                    <div>
                        {data() && data()!.result.author && (
                            <div class='flex justify-center flex-wrap'>
                                <div class="relative">
                                    <img crossorigin="anonymous" class="rounded-full h-32 w-32" src={data()!.result.author?.avatar ?? ""} alt={data()!.result.author.nickname ?? ""} /><a class="absolute bottom-0 right-0" href={`https://dl.tiktokiocdn.workers.dev/api/download?url=${encodeURIComponent(data()!.result.author?.avatar ?? "")}&type=.png&title=${data()!.result.author?.nickname ?? ""}`}><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M7 17h10v-2H7zm5-3l4-4l-1.4-1.4l-1.6 1.55V6h-2v4.15L9.4 8.6L8 10zm0 8q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22"></path></svg></a></div>
                                <h1 class='text-2xl font-bold text-center w-full mt-2'>{data()!.result.author?.nickname}</h1>
                            </div>
                        )}
                    </div>

                    <div>
                        <video controls src={data()!.result.video1 ?? data()!.result.videoHD ?? data()!.result.videoWatermark ?? data()!.result.video_diyoun ?? ""} class=" rounded-md shadow-md my-3 w-3/4 mx-auto"></video>
                        <p class='text-center text-lg font-semibold mx-auto'>{data()!.result.desc}</p>

                    </div>
                    <div class='flex flex-col justify-center gap-2 mt-2 rounded-md shadow-md my-3 w-11/12 mx-auto'>
                        {data()!.result.video1 && <a href={`https://dl.tiktokiocdn.workers.dev/api/download?url=${encodeURIComponent(data()!.result.video1 ?? "")}&type=.mp4&title=${data()!.result.author?.nickname}`} class="p-2 bg-blue-600 shadow-md h-10 rounded text-white">Download Video Low Without Watermaker</a>}
                        {data()!.result.videoHD && <a href={`https://dl.tiktokiocdn.workers.dev/api/download?url=${encodeURIComponent(data()!.result.videoHD ?? "")}&type=.mp4&title=${data()!.result.author?.nickname}`} class="p-2 bg-blue-600 shadow-md h-10 rounded text-white">Download Video HD Without Watermaker</a>}
                        {data()!.result.videoWatermark && <a href={`https://dl.tiktokiocdn.workers.dev/api/download?url=${encodeURIComponent(data()!.result.videoWatermark ?? "")}&type=.mp4&title=${data()!.result.author?.nickname}`} class="p-2 bg-blue-600 shadow-md h-10 rounded text-white">Download Video With Watermark</a>}
                        {data()!.result.music && <a href={`https://dl.tiktokiocdn.workers.dev/api/download?url=${encodeURIComponent(data()!.result.music ?? "")}&type=.mp3&title=${data()!.result.author?.nickname ?? ""}`} class="p-2 bg-blue-600 shadow-md h-10 rounded text-white">Download Audio Only</a>}
                        {data()!.result.video_diyoun && <a href={`https://dl.tiktokiocdn.workers.dev/api/download?url=${encodeURIComponent(data()!.result.video_diyoun ?? "")}&type=.mp4&title=${data()!.result.author?.nickname}`} class="p-2 bg-blue-600 shadow-md h-10 rounded text-white">Download Diyoun Video HD Without Watermaker</a>}


                    </div>


                </div>
            )}
        </div>
    )

}

export default InputScreen
